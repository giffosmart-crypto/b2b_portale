{% block content %}

<!-- INTRO -->
<div class="mb-6">
    <p class="text-slate-600 text-sm">
        Ciao
        <strong class="text-slate-900">{{ request.user.first_name|default:request.user.username }}</strong>,
        queste sono le righe d’ordine assegnate al tuo profilo partner.
    </p>
</div>

<!-- KPI -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">

    <div class="bg-white border border-slate-200 rounded-2xl p-4">
        <p class="text-xs text-slate-500 uppercase">Righe totali</p>
        <p class="text-2xl font-semibold text-slate-900">
            {{ partner_total_items|default:"0" }}
        </p>
    </div>

    <div class="bg-white border border-slate-200 rounded-2xl p-4">
        <p class="text-xs text-slate-500 uppercase">In corso</p>
        <p class="text-2xl font-semibold text-blue-600">
            {{ partner_open_items|default:"0" }}
        </p>
    </div>

    <div class="bg-white border border-slate-200 rounded-2xl p-4">
        <p class="text-xs text-slate-500 uppercase">Completate</p>
        <p class="text-2xl font-semibold text-emerald-600">
            {{ partner_completed_items|default:"0" }}
        </p>
    </div>

    <div class="bg-white border border-slate-200 rounded-2xl p-4">
        <p class="text-xs text-slate-500 uppercase">Rifiutate</p>
        <p class="text-2xl font-semibold text-rose-600">
            {{ partner_rejected_items|default:"0" }}
        </p>
    </div>

</div>

<!-- TITOLO -->
<h2 class="text-lg font-semibold text-slate-900 mb-3">Dettaglio righe d’ordine</h2>

<!-- TABELLA -->
{% if items %}
    <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-slate-200 rounded-xl text-sm">
            <thead class="bg-slate-50 text-slate-600 text-xs uppercase">
                <tr>
                    <th class="px-3 py-2 text-left">ID riga</th>
                    <th class="px-3 py-2 text-left">Ordine</th>
                    <th class="px-3 py-2 text-left">Struttura</th>
                    <th class="px-3 py-2 text-left">Prodotto</th>
                    <th class="px-3 py-2 text-left">Quantità</th>
                    <th class="px-3 py-2 text-left">Totale</th>
                    <th class="px-3 py-2 text-left">Stato partner</th>
                    <th class="px-3 py-2 text-left">Ultimo aggiornamento</th>
                    <th class="px-3 py-2 text-left">Azioni</th>
                </tr>
            </thead>

            <tbody class="divide-y divide-slate-100">

                {% for item in items %}
                    <tr class="hover:bg-slate-50">

                        <!-- ID Riga -->
                        <td class="px-3 py-2 font-medium text-slate-900">
                            #{{ item.id }}
                        </td>

                        <!-- ID Ordine -->
                        <td class="px-3 py-2 font-medium text-slate-900">
                            #{{ item.order.id }}
                        </td>

                        <!-- Struttura -->
                        <td class="px-3 py-2">
                            {{ item.order.structure }}
                        </td>

                        <!-- Prodotto -->
                        <td class="px-3 py-2">
                            {{ item.product.name }}
                        </td>

                        <!-- Quantità -->
                        <td class="px-3 py-2 font-medium text-slate-900">
                            {{ item.quantity }}
                        </td>

                        <!-- Totale -->
                        <td class="px-3 py-2 font-medium text-slate-900">
                            {{ item.total_price }} €
                        </td>

                        <!-- Partner Status Badge -->
                        <td class="px-3 py-2">
                            <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium
                                {% if item.partner_status == 'pending' %}
                                    bg-slate-100 text-slate-700
                                {% elif item.partner_status == 'accepted' %}
                                    bg-blue-100 text-blue-700
                                {% elif item.partner_status == 'in_progress' %}
                                    bg-yellow-100 text-yellow-800
                                {% elif item.partner_status == 'shipped' %}
                                    bg-indigo-100 text-indigo-800
                                {% elif item.partner_status == 'completed' %}
                                    bg-emerald-100 text-emerald-800
                                {% elif item.partner_status == 'rejected' %}
                                    bg-rose-100 text-rose-800
                                {% endif %}
                            ">
                                {{ item.get_partner_status_display }}
                            </span>
                        </td>

                        <!-- Ultimo aggiornamento -->
                        <td class="px-3 py-2 text-slate-500">
                            {{ item.order.updated_at|date:"d/m/Y H:i" }}
                        </td>

                        <!-- Azione -->
                        <td class="px-3 py-2">
                            <a href="{% url 'partners:order_detail' item.order.id %}"
                               class="text-blue-600 hover:text-blue-800 font-medium">
                                Vedi ordine
                            </a>
                        </td>

                    </tr>
                {% endfor %}

            </tbody>
        </table>
    </div>

{% else %}
    <p class="text-slate-500 text-sm">
        Non ci sono righe d’ordine assegnate al tuo profilo partner.
    </p>
{% endif %}

{% endblock %}
