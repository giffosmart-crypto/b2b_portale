{% extends "backoffice/base_admin.html" %}

{% block page_title %}Lista Ordini{% endblock %}

{% block admin_content %}

<h1 class="mb-4">Ordini</h1>

<!-- FILTRI -->
<div class="card mb-4">
  <div class="card-header">
    <strong>Filtri</strong>
  </div>
  <div class="card-body">

    <form method="get" style="display:flex; flex-direction:column; gap:12px;">

      <!-- RIGA 1: Stato, Cliente, Partner -->
      <div style="display:flex; flex-wrap:wrap; gap:12px;">

        <!-- Stato ordine -->
        <div style="flex: 1 1 180px; min-width:180px;">
          <label class="form-label" style="margin-bottom:4px;">Stato ordine</label>
          <select name="status" class="form-select">
            <option value="">Tutti</option>
            {% if orders %}
              {% for value, label in orders.first.STATUS_CHOICES %}
                <option value="{{ value }}" {% if selected_status == value %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            {% endif %}
          </select>
        </div>

        <!-- Cliente email -->
        <div style="flex: 1 1 220px; min-width:220px;">
          <label class="form-label" style="margin-bottom:4px;">Cliente (email)</label>
          <input
            type="text"
            name="client"
            class="form-control"
            placeholder="email..."
            value="{{ client_email }}"
          >
        </div>

        <!-- Partner -->
        <div style="flex: 1 1 220px; min-width:220px;">
          <label class="form-label" style="margin-bottom:4px;">Partner</label>
          <select name="partner" class="form-select">
            <option value="">Tutti</option>
            {% for p in partners %}
              <option value="{{ p.id }}" {% if selected_partner == p.id %}selected{% endif %}>
                {{ p.company_name }}
              </option>
            {% endfor %}
          </select>
        </div>

      </div>

      <!-- RIGA 2: Date + Pulsanti -->
      <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end;">

        <!-- Da data -->
        <div style="flex: 1 1 180px; min-width:180px;">
          <label class="form-label" style="margin-bottom:4px;">Da data</label>
          <input
            type="date"
            name="date_from"
            value="{{ date_from }}"
            class="form-control"
          >
        </div>

        <!-- A data -->
        <div style="flex: 1 1 180px; min-width:180px;">
          <label class="form-label" style="margin-bottom:4px;">A data</label>
          <input
            type="date"
            name="date_to"
            value="{{ date_to }}"
            class="form-control"
          >
        </div>

        <!-- Bottoni -->
        <div style="flex: 0 0 auto; margin-left:auto; display:flex; gap:8px;">
          <button class="btn btn-primary" type="submit">
            Filtra
          </button>
          <a href="" class="btn btn-secondary">
            Reset
          </a>
        </div>

      </div>

    </form>
  </div>
</div>


<!-- LISTA ORDINI -->
<div class="card">
  <div class="card-header bg-primary text-white">
    <strong>Risultati</strong>
  </div>

  <div class="card-body p-0">
    <table class="table table-striped table-hover table-sm mb-0">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Cliente</th>
          <th>Struttura</th>
          <th>Totale (â‚¬)</th>
          <th>Stato</th>
          <th>Data</th>
          <th></th>
        </tr>
      </thead>
      <tbody>

        {% for order in orders %}
        <tr>
          <td>#{{ order.id }}</td>
          <td>{{ order.client.email }}</td>
          <td>
  {% if order.structure %}
    {{ order.structure.name }}
  {% else %}
    -
  {% endif %}
</td>
          <td>{{ order.total }}</td>
          <td>{{ order.get_status_display }}</td>
          <td>{{ order.created_at|date:"d/m/Y H:i" }}</td>
          <td>
            <a href="{% url 'backoffice:order_detail' order.id %}" class="btn btn-sm btn-primary">
              Dettaglio
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-center">Nessun ordine trovato.</td>
        </tr>
        {% endfor %}

      </tbody>
    </table>
  </div>
</div>

{% endblock %}
