<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <title>{% block title %}Portale B2B turistico{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Tailwind CSS via CDN (per sviluppo) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Inter -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">

    <style>
        body {
            margin: 0;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: #f5f5f7;
        }

        /* --- Componenti area admin (card, tabelle, bottoni) --- */

        .card {
            background-color: #ffffff;
            border-radius: 1rem;            /* come i container principali */
            border: 1px solid #e5e7eb;      /* slate-200 */
            box-shadow: 0 1px 2px rgb(15 23 42 / 0.06);
            margin-bottom: 1rem;
        }

        .card-header {
            padding: 0.6rem 1rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.8rem;
            font-weight: 600;
            color: #0f172a;
            background-color: #f9fafb;      /* slate-50 */
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
        }

        .card-body {
            padding: 0.75rem 1rem;
        }

        /* Varianti colore header (usate nei template admin) */
        .card-header.bg-primary {
            background-color: #2563eb;      /* blue-600 */
            color: #ffffff;
        }

        .card-header.bg-success {
            background-color: #16a34a;      /* green-600 */
            color: #ffffff;
        }

        .card-header.bg-info {
            background-color: #0ea5e9;      /* sky-500 */
            color: #ffffff;
        }

        .card-header.bg-warning {
            background-color: #facc15;      /* yellow-400 */
            color: #0f172a;
        }

        .card-header.bg-dark {
            background-color: #0f172a;      /* slate-900 */
            color: #ffffff;
        }

        /* Tabelle stile Tailwind-like */
        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;            /* text-sm */
        }

        .table th,
        .table td {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid #e5e7eb;   /* slate-200 */
            text-align: left;
        }

        .table-sm th,
        .table-sm td {
            padding-top: 0.35rem;
            padding-bottom: 0.35rem;
        }

        .table thead th {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6b7280;                 /* slate-500 */
            background-color: #f9fafb;      /* slate-50 */
        }

        .table-striped tbody tr:nth-child(odd) {
            background-color: #f9fafb;      /* zebra soft */
        }

        .table-hover tbody tr:hover {
            background-color: #e5e7eb40;    /* leggero highlight */
        }

        /* Pulsanti stile portale */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            background-color: #ffffff;
            color: #0f172a;
            cursor: pointer;
            text-decoration: none;
        }

        .btn:hover {
            background-color: #f1f5f9;      /* slate-100 */
        }

        .btn-primary {
            background-color: #2563eb;      /* blue-600 */
            border-color: #2563eb;
            color: #ffffff;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;      /* blue-700 */
        }

        .btn-secondary {
            background-color: #e5e7eb;      /* slate-200 */
            border-color: #e5e7eb;
            color: #0f172a;
        }

        .btn-secondary:hover {
            background-color: #cbd5f5;
        }

        .btn-sm {
            padding: 0.15rem 0.5rem;
            font-size: 0.75rem;
        }

        .table-light th {
            background-color: #f9fafb;
        }

        .badge {
            display: inline-block;
            min-width: 18px;
            padding: 2px 6px;
            border-radius: 999px;
            background-color: #dc3545;
            color: #fff;
            font-size: 11px;
            margin-left: 4px;
        }

        .badge-pill {
            display: inline-block;
            min-width: 20px;
            padding: 2px 6px;
            margin-left: 6px;
            font-size: 11px;
            border-radius: 999px;
            background-color: #ef4444;
            color: #fff;
            text-align: center;
        }

        .flash {
            padding: 10px 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            font-size: 14px;
        }

        .flash-success {
            background-color: #dcfce7;
            color: #166534;
        }

        .flash-error {
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .flash-info {
            background-color: #e0f2fe;
            color: #075985;
        }

        .flash-warning {
            background-color: #fef3c7;
            color: #92400e;
        }

        /* --- Stile base campi form --- */
        form input[type="text"],
        form input[type="email"],
        form input[type="password"],
        form input[type="number"],
        form input[type="date"],
        form select,
        form textarea {
            width: 100%;
            border-radius: 0.75rem; /* rounded-xl */
            border: 1px solid #e5e7eb; /* slate-200 */
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            background-color: #f9fafb; /* slate-50 */
        }

        form input:focus,
        form select:focus,
        form textarea:focus {
            outline: none;
            border-color: #2563eb; /* blue-600 */
            box-shadow: 0 0 0 1px #2563eb33;
            background-color: #ffffff;
        }

        ul.errorlist {
            margin: 4px 0 0;
            padding-left: 1rem;
            list-style: disc;
            color: #b91c1c; /* red-700 */
            font-size: 0.75rem;
        }

        ul.errorlist li {
            margin: 0;
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>
<body class="bg-slate-50 text-slate-900">

<!-- MOBILE SIDEBAR (drawer) -->
<div id="mobile-sidebar" class="fixed inset-0 z-40 md:hidden hidden">
    <!-- Overlay -->
    <div class="absolute inset-0 bg-slate-900/40" onclick="closeMobileMenu()"></div>

    <!-- Pannello laterale -->
    <div class="relative h-full w-72 max-w-[80%] bg-white shadow-xl flex flex-col">
        <div class="h-14 flex items-center justify-between px-4 border-b border-slate-100">
            <div class="inline-flex items-center gap-2">
                <span class="h-8 w-8 rounded-xl bg-blue-600 text-white flex items-center justify-center text-sm font-semibold">
                    B2B
                </span>
                <span class="font-semibold text-slate-900 tracking-tight">
                    B2B Turismo
                </span>
            </div>
            <button type="button"
                    class="inline-flex items-center justify-center h-8 w-8 rounded-lg border border-slate-200 text-slate-500 hover:bg-slate-100"
                    onclick="closeMobileMenu()">
                ‚úï
            </button>
        </div>

        <!-- Menu mobile -->
        <nav class="flex-1 overflow-y-auto px-3 py-4 space-y-1 text-sm">
            <p class="px-3 text-xs font-semibold text-slate-400 uppercase mb-2">
                Navigazione
            </p>

            {% if request.user.is_authenticated %}
                {# Catalogo + Carrello SOLO se non sei partner e NON nel backoffice #}
                {% if request.user.role != "partner" %}
                    {% if not request.resolver_match or request.resolver_match.namespace != "backoffice" %}
                        <a href="{% url 'catalog:product_list' %}"
                           class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                            <span>üõç Catalogo</span>
                        </a>

                        <a href="{% url 'orders:cart_detail' %}"
   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
    <span>üß∫ Carrello</span>
    {% if cart_item_count %}
        <span class="badge-pill">{{ cart_item_count }}</span>
    {% endif %}
</a>
                    {% endif %}
                {% endif %}

                {% if request.user.role == "client" %}
    <a href="{% url 'accounts:my_dashboard' %}"
       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
        <span>üè† Area clienti</span>
    </a>
    <a href="/my/orders/"
       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
        <span>üìë I miei ordini</span>
    </a>
    <a href="{% url 'accounts:my_profile' %}"
       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
        <span>üë§ Il mio profilo</span>
    </a>
{% elif request.user.role == "partner" %}
                    <a href="{% url 'partners:dashboard' %}"
                       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                        <span>ü§ù Dashboard partner</span>
                    </a>
                    <a href="{% url 'partners:order_list' %}"
                       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                        <span>üì¶ Ordini da evadere</span>
                        {% if partner_open_items_count %}
                            <span class="badge-pill">{{ partner_open_items_count }}</span>
                        {% endif %}
                    </a>
                    <a href="{% url 'partners:order_archive' %}"
                       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                        <span>üóÇ Archivio ordini</span>
                    </a>
                    <a href="{% url 'partners:product_list' %}"
                       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                        <span>üìö Catalogo prodotti / servizi</span>
                    </a>
                    <a href="{% url 'partners:analytics' %}"
                       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                       <span>üìä Report & grafici</span>
                    </a>
                    <a href="{% url 'partners:commissions' %}"
                       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                       <span>üí∂ Commissioni & pagamenti</span>
                    </a>
                    <a href="{% url 'partners:notifications' %}"
                       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                       <span>üîî Notifiche</span>
                       {% if partner_unread_notifications_count %}
                       <span class="badge-pill">{{ partner_unread_notifications_count }}</span>
                       {% endif %}
                    </a>
                    <a href="{% url 'partners:profile' %}"
                       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                        <span>üë§ Profilo partner</span>
                    </a>
                {% elif request.user.role == "admin" %}
                    <a href="{% url 'accounts:my_profile' %}"
                       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                        <span>üë§ Profilo amministratore</span>
                    </a>

                    <details class="group rounded-xl">
                      <summary class="list-none cursor-pointer flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                        <span>üõ† Admin Panel</span>
                        <span class="text-slate-400 group-open:rotate-180 transition">‚ñæ</span>
                      </summary>

                      <div class="ml-3 mt-2 space-y-1">
                        <a href="{% url 'backoffice:dashboard' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Dashboard
                        </a>
                        <a href="{% url 'backoffice:order_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Ordini
                        </a>
                        <a href="{% url 'backoffice:partner_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Partner
                        </a>
                        <a href="{% url 'backoffice:client_structure_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Strutture cliente
                        </a>
                        <a href="{% url 'backoffice:category_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Categorie prodotto
                        </a>
                        <a href="{% url 'backoffice:product_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Prodotti / Servizi
                        </a>
                        <a href="{% url 'backoffice:kit_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Kit / Componenti
                        </a>
                        <a href="{% url 'backoffice:cms_page_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Pagine CMS
                        </a>
                        <a href="{% url 'backoffice:review_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Recensioni prodotti
                        </a>
                        <a href="{% url 'backoffice:user_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Utenti
                        </a>
                        <a href="{% url 'backoffice:partner_commission_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Commissioni partner
                        </a>
                        <a href="{% url 'backoffice:commission_report' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">
                          Report & Grafici
                        </a>
                      </div>
                    </details>
                {% endif %}
            {% endif %}

            <p class="px-3 text-xs font-semibold text-slate-400 uppercase mt-4 mb-2">
                Sistema
            </p>

            {% if request.user.is_authenticated %}
            {% if request.user.is_staff or request.user.role == "admin" %}
            {% if request.user.is_authenticated %}
            {% if request.user.is_staff or request.user.role == "admin" %}
            {% if request.user.is_authenticated %}
            {% if request.user.is_staff or request.user.role == "admin" %}
            {% if request.user.is_authenticated %}
            {% if request.user.is_staff or request.user.role == "admin" %}
            {% if request.user.is_authenticated %}
            {% if request.user.is_staff or request.user.role == "admin" %}
            <a href="/admin/"
               class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                <span>‚öôÔ∏è Admin</span>
            </a>
            {% endif %}
            {% endif %}
            {% endif %}
            {% endif %}
            {% endif %}
            {% endif %}
            {% endif %}
            {% endif %}
            {% endif %}
            {% endif %}

            <a href="{% url 'contact' %}"
               class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                <span>üì© Contatti</span>
            </a>
        </nav>

        {% if request.user.is_authenticated %}
        <div class="border-t border-slate-100 px-4 py-3 flex items-center justify-between text-xs text-slate-500">
            <div>
                <p class="font-medium text-slate-700">
                    {{ request.user.first_name|default:request.user.username }}
                </p>
                <p class="capitalize">
                    {{ request.user.role }}
                </p>
            </div>
            <a href="{% url 'accounts:logout' %}"
               class="inline-flex items-center text-slate-400 hover:text-slate-700 text-xs">
                Logout
            </a>
        </div>
        {% else %}
        <div class="border-t border-slate-100 px-4 py-3 flex items-center justify-between text-xs text-slate-500">
            <a href="{% url 'accounts:login' %}"
               class="inline-flex items-center rounded-xl border border-slate-200 px-3 py-1.5 hover:bg-slate-100">
                Login
            </a>
        </div>
        {% endif %}
    </div>
</div>

<div class="min-h-screen flex">

    <!-- SIDEBAR DESKTOP -->
    <aside class="hidden md:flex md:flex-col w-64 bg-white border-r border-slate-200">
        <!-- Logo -->
        <div class="h-16 flex items-center px-6 border-b border-slate-100">
            <span class="inline-flex items-center gap-2">
                <span class="h-8 w-8 rounded-xl bg-blue-600 text-white flex items-center justify-center text-sm font-semibold">
                    B2B
                </span>
                <span class="font-semibold text-slate-900 tracking-tight">
                    B2B Turismo
                </span>
            </span>
        </div>

        <!-- Menu -->
        <nav class="flex-1 overflow-y-auto px-3 py-4 space-y-1 text-sm">
            <p class="px-3 text-xs font-semibold text-slate-400 uppercase mb-2">
                Generale
            </p>

            {% if request.user.is_authenticated %}
                {# Catalogo + Carrello SOLO se non sei partner e NON nel backoffice #}
                {% if request.user.role != "partner" %}
                    {% if not request.resolver_match or request.resolver_match.namespace != "backoffice" %}
                        <a href="{% url 'catalog:product_list' %}"
                           class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                            <span>üõç Catalogo</span>
                        </a>

                        <a href="{% url 'orders:cart_detail' %}"
   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
    <span>üß∫ Carrello</span>
    {% if cart_item_count %}
        <span class="badge-pill">{{ cart_item_count }}</span>
    {% endif %}
</a>
                        </a>
                    {% endif %}
                {% endif %}
            {% endif %}

            {% if request.user.is_authenticated and request.user.role == "client" %}
    <p class="px-3 text-xs font-semibold text-slate-400 uppercase mt-4 mb-2">
        Area cliente
    </p>
    <a href="{% url 'accounts:my_dashboard' %}"
       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
        <span>üè† Area clienti</span>
    </a>
    <a href="/my/orders/"
       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
        <span>üìë I miei ordini</span>
    </a>
    <a href="{% url 'accounts:my_profile' %}"
       class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
        <span>üë§ Il mio profilo</span>
    </a>
{% endif %}

            {% if request.user.is_authenticated and request.user.role == "partner" %}
                <p class="px-3 text-xs font-semibold text-slate-400 uppercase mt-4 mb-2">
                    Area partner
                </p>
                <a href="{% url 'partners:dashboard' %}"
                   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                    <span>ü§ù Dashboard partner</span>
                </a>
                <a href="{% url 'partners:order_list' %}"
                   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                    <span>üì¶ Ordini da evadere</span>
                    {% if partner_open_items_count %}
                        <span class="badge-pill">{{ partner_open_items_count }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'partners:order_archive' %}"
                   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                    <span>üóÇ Archivio ordini</span>
                </a>
                <a href="{% url 'partners:product_list' %}"
                   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                    <span>üìö Catalogo prodotti / servizi</span>
                </a>
                <a href="{% url 'partners:analytics' %}"
                   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                   <span>üìä Report & grafici</span>
                </a>
                <a href="{% url 'partners:commissions' %}"
                   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                   <span>üí∂ Commissioni & pagamenti</span>
                </a>
                <a href="{% url 'partners:notifications' %}"
                   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                   <span>üîî Notifiche</span>
                   {% if partner_unread_notifications_count %}
                   <span class="badge-pill">{{ partner_unread_notifications_count }}</span>
                   {% endif %}
                </a>
                <a href="{% url 'partners:profile' %}"
                   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                    <span>üë§ Profilo partner</span>
                </a>
            {% endif %}

            <p class="px-3 text-xs font-semibold text-slate-400 uppercase mt-4 mb-2">
                Sistema
            </p>

            {% if request.user.is_authenticated %}
            {% if request.user.is_staff or request.user.role == "admin" %}
            <a href="/admin/"
               class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                <span>‚öôÔ∏è Admin</span>
            </a>
            {% endif %}
            {% endif %}

            {% if request.user.is_authenticated and request.user.role == "admin" %}
                <a href="{% url 'accounts:my_profile' %}"
                   class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                    <span>üë§ Profilo amministratore</span>
                </a>

                <details class="group rounded-xl" open>
                  <summary class="list-none cursor-pointer flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                    <span>üõ† Admin Panel</span>
                    <span class="text-slate-400 group-open:rotate-180 transition">‚ñæ</span>
                  </summary>

                  <div class="ml-3 mt-2 space-y-1">
                    <a href="{% url 'backoffice:dashboard' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Dashboard</a>
                    <a href="{% url 'backoffice:order_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Ordini</a>
                    <a href="{% url 'backoffice:partner_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Partner</a>
                    <a href="{% url 'backoffice:client_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Clienti</a>
                    <a href="{% url 'backoffice:client_structure_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Strutture cliente</a>
                    <a href="{% url 'backoffice:category_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Categorie prodotto</a>
                    <a href="{% url 'backoffice:product_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Prodotti / Servizi</a>
                    <a href="{% url 'backoffice:kit_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Kit / Componenti</a>
                    <a href="{% url 'backoffice:cms_page_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Pagine CMS</a>
                    <a href="{% url 'backoffice:review_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Recensioni prodotti</a>
                    <a href="{% url 'backoffice:user_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Utenti</a>
                    <a href="{% url 'backoffice:partner_commission_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Commissioni partner</a>
                    <a href="{% url 'backoffice:partner_payout_list' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Payout partner</a>
                    <a href="{% url 'backoffice:commission_report' %}" class="block px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700 text-sm">Report &amp; Grafici</a>
                  </div>
                </details>
            {% endif %}

            <a href="{% url 'contact' %}"
               class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-slate-100 text-slate-700">
                <span>üì© Contatti</span>
            </a>
        </nav>

        {% if request.user.is_authenticated %}
        <div class="border-t border-slate-100 px-4 py-3 flex items-center justify-between text-xs text-slate-500">
            <div>
                <p class="font-medium text-slate-700">
                    {{ request.user.first_name|default:request.user.username }}
                </p>
                <p class="capitalize">
                    {{ request.user.role }}
                </p>
            </div>
            <a href="{% url 'accounts:logout' %}"
               class="inline-flex items-center text-slate-400 hover:text-slate-700 text-xs">
                Logout
            </a>
        </div>
        {% endif %}
    </aside>

    <!-- COLONNA DESTRA: TOPBAR + CONTENUTO -->
    <div class="flex-1 flex flex-col">

        <!-- Topbar -->
        <header class="h-14 md:h-16 bg-white border-b border-slate-200 flex items-center px-3 md:px-6 justify-between">
            <div class="flex items-center gap-2 md:gap-4">
                <!-- Bottone menu mobile -->
                <button type="button"
                        class="md:hidden inline-flex items-center justify-center h-9 w-9 rounded-lg border border-slate-200 bg-white"
                        onclick="openMobileMenu()"
                        aria-label="Apri il menu di navigazione">
                    <span class="sr-only">Apri menu</span>
                    ‚ò∞
                </button>

                <h1 class="text-base md:text-lg font-semibold text-slate-900 tracking-tight">
                    {% block page_title %}{% endblock %}
                </h1>
            </div>

            <div class="flex items-center gap-2 md:gap-3">


                {% if request.user.is_authenticated and request.user.role == "admin" %}
                    {% if not request.resolver_match or request.resolver_match.namespace != "backoffice" %}
                        <!-- Search desktop (solo admin, fuori dal backoffice) -->
                        <form action="{% url 'catalog:product_list' %}" method="get" class="hidden md:block">
                            <div class="relative">
                                <input type="text" name="q"
                                       placeholder="Cerca nel catalogo..."
                                       class="w-64 rounded-xl border border-slate-200 bg-slate-50 px-3 py-1.5 text-sm
                                              focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white">
                            </div>
                        </form>

                        <!-- Carrello (solo admin, fuori dal backoffice) -->
                        <a href="{% url 'orders:cart_detail' %}"
                           class="inline-flex items-center gap-1 text-sm text-slate-600 hover:text-slate-900">
                            <span>üß∫</span>
                            <span class="hidden sm:inline">Carrello</span>
                            {% if cart_item_count %}
                                <span class="hidden md:inline text-xs text-slate-500">
                                    ({{ cart_item_count }} ‚Äì ‚Ç¨ {{ cart_total }})
                                </span>
                            {% endif %}
                        </a>
                    {% endif %}
                {% endif %}

                <!-- User menu -->
                <div class="flex items-center gap-2 text-xs sm:text-sm">

                    {% if request.user.is_authenticated %}
                        <div class="hidden sm:flex items-center gap-2">
                            <div class="h-8 w-8 rounded-full bg-slate-700 text-white flex items-center justify-center text-xs font-semibold">
                                {{ request.user.first_name|default:request.user.username|first|upper }}
                            </div>
                            <span class="text-slate-700">
                                Ciao,
                                <strong>{{ request.user.first_name|default:request.user.username }}</strong>
                            </span>
                        </div>

                        {% if request.user.role == "partner" %}
                            <a href="{% url 'partners:profile' %}"
                               class="inline-flex items-center rounded-xl border border-slate-200 px-2.5 py-1.5 hover:bg-slate-100 text-xs sm:text-sm">
                                Profilo
                            </a>
                        {% else %}
                            <a href="{% url 'accounts:my_profile' %}"
                               class="inline-flex items-center rounded-xl border border-slate-200 px-2.5 py-1.5 hover:bg-slate-100 text-xs sm:text-sm">
                                Profilo
                            </a>
                        {% endif %}

                        <a href="{% url 'accounts:password_change' %}"
                           class="inline-flex items-center rounded-xl border border-slate-200 px-2.5 py-1.5 hover:bg-slate-100 text-xs sm:text-sm">
                            Password
                        </a>

                        <a href="{% url 'accounts:logout' %}"
                           class="inline-flex items-center rounded-xl border border-slate-200 px-2.5 py-1.5 hover:bg-slate-100 text-xs sm:text-sm">
                            Logout
                        </a>
                    {% else %}
                        <a href="{% url 'accounts:login' %}"
                           class="inline-flex items-center rounded-xl border border-slate-200 px-3 py-1.5 hover:bg-slate-100 text-xs sm:text-sm">
                            Login
                        </a>
                    {% endif %}
                </div>
            </div>
        </header>

        {% include "partials/flash_messages.html" %}

        <main class="flex-1 px-3 md:px-6 py-4 md:py-6">
            <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-sm border border-slate-100 p-4 md:p-6">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>
</div>

{% block extra_js %}{% endblock %}

<script>
    function openMobileMenu() {
        const el = document.getElementById('mobile-sidebar');
        if (!el) return;
        el.classList.remove('hidden');
    }

    function closeMobileMenu() {
        const el = document.getElementById('mobile-sidebar');
        if (!el) return;
        el.classList.add('hidden');
    }
</script>
</body>
</html>